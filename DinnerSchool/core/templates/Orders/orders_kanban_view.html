<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pedidos Kanban - Cafetería Escolar</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carga de la fuente Inter de Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Estilos personalizados para la tipografía y colores */
      body {
        font-family: "Inter", sans-serif;
        background-color: #f3f4f6; /* Un gris claro para el fondo */
      }
      .bg-primary-red {
        background-color: #dc2626; /* Rojo del logo */
      }
      .text-primary-red {
        color: #dc2626; /* Rojo del logo */
      }
      .border-primary-red {
        border-color: #dc2626; /* Rojo del logo */
      }
      .shadow-custom {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }
      /* Estilos para el arrastrar y soltar */
      .dragging {
        opacity: 0.5;
        border: 2px dashed #dc2626;
      }
      .drag-over {
        background-color: #fbd38d; /* Un color suave para indicar que se puede soltar */
      }
    </style>
  </head>
  <body class="flex flex-col items-center min-h-screen p-4">
    <div
      class="bg-white p-8 rounded-lg shadow-xl max-w-6xl w-full border-t-8 border-primary-red mb-8"
    >
      <div class="flex flex-col md:flex-row items-center justify-between mb-6">
        <!-- Logo de la cafetería -->
        <div class="flex items-center mb-4 md:mb-0">
          <img
            src="https://placehold.co/120x120/DC2626/FFFFFF?text=CERTO"
            alt="Logo de la Cafetería Certo"
            class="w-16 h-16 rounded-full border-2 border-primary-red p-1 object-cover mr-4"
          />
          <h1 class="text-3xl font-bold text-gray-800">
            Gestión de Pedidos (Kanban)
          </h1>
        </div>
        <!-- Botón para volver -->
        <div class="text-right">
          <button
            onclick="window.history.back()"
            class="px-4 py-2 text-sm font-medium text-white bg-gray-600 rounded-md hover:bg-gray-700 transition duration-300 ease-in-out"
          >
            Volver
          </button>
        </div>
      </div>

      <!-- Contenedor del tablero Kanban -->
      <div class="flex flex-col md:flex-row gap-6 justify-center">
        <!-- Columna: Pendiente -->
        <div
          id="pendiente-column"
          class="kanban-column flex-1 bg-gray-100 p-4 rounded-lg shadow-custom min-w-[280px]"
          ondragover="allowDrop(event)"
          ondrop="drop(event)"
          ondragleave="dragLeave(event)"
        >
          <h2 class="text-xl font-semibold text-gray-800 mb-4 text-center">
            Pendiente
          </h2>
          <div id="pendiente-cards" class="space-y-4 min-h-[100px]">
            <!-- Las tarjetas se cargarán aquí por JS -->
          </div>
        </div>

        <!-- Columna: En Preparación -->
        <div
          id="en-preparacion-column"
          class="kanban-column flex-1 bg-yellow-100 p-4 rounded-lg shadow-custom min-w-[280px]"
          ondragover="allowDrop(event)"
          ondrop="drop(event)"
          ondragleave="dragLeave(event)"
        >
          <h2 class="text-xl font-semibold text-gray-800 mb-4 text-center">
            En Preparación
          </h2>
          <div id="en-preparacion-cards" class="space-y-4 min-h-[100px]">
            <!-- Las tarjetas se cargarán aquí por JS -->
          </div>
        </div>

        <!-- Columna: Finalizado -->
        <div
          id="finalizado-column"
          class="kanban-column flex-1 bg-green-100 p-4 rounded-lg shadow-custom min-w-[280px]"
          ondragover="allowDrop(event)"
          ondrop="drop(event)"
          ondragleave="dragLeave(event)"
        >
          <h2 class="text-xl font-semibold text-gray-800 mb-4 text-center">
            Finalizado
          </h2>
          <div id="finalizado-cards" class="space-y-4 min-h-[100px]">
            <!-- Las tarjetas se cargarán aquí por JS -->
          </div>
        </div>
      </div>
    </div>

    <script>
      // Datos de prueba para los pedidos
      let orders = [
        {
          id: "order-1",
          platillo: "Hamburguesa Clásica",
          ingredientes: "Sin cebolla, extra queso",
          nota: "Para llevar",
          alumno: "Ana García",
          nivel: "Primaria",
          turno: "Comida",
          status: "pendiente",
        },
        {
          id: "order-2",
          platillo: "Ensalada César",
          ingredientes: "Aderezo aparte",
          nota: "",
          alumno: "Carlos Martínez",
          nivel: "Secundaria",
          turno: "Comida",
          status: "en preparacion",
        },
        {
          id: "order-3",
          platillo: "Sándwich de Pavo",
          ingredientes: "Pan integral, sin tomate",
          nota: "Alérgico a los cacahuates",
          alumno: "Sofía Rodríguez",
          nivel: "Primaria",
          turno: "Desayuno",
          status: "pendiente",
        },
        {
          id: "order-4",
          platillo: "Tacos Dorados",
          ingredientes: "Con crema y queso",
          nota: "",
          alumno: "Diego Hernández",
          nivel: "Secundaria",
          turno: "Comida",
          status: "finalizado",
        },
        {
          id: "order-5",
          platillo: "Fruta Picada",
          ingredientes: "Solo manzana y uva",
          nota: "Para recoger a las 10:00 AM",
          alumno: "Laura González",
          nivel: "Primaria",
          turno: "Desayuno",
          status: "pendiente",
        },
        {
          id: "order-6",
          platillo: "Pasta Alfredo",
          ingredientes: "Extra pollo",
          nota: "",
          alumno: "Juan Pérez",
          nivel: "Preparatoria",
          turno: "Comida",
          status: "en preparacion",
        },
        {
          id: "order-7",
          platillo: "Pizza de Pepperoni",
          ingredientes: "Doble queso",
          nota: "Cortar en 8 rebanadas",
          alumno: "María López",
          nivel: "Secundaria",
          turno: "Comida",
          status: "pendiente",
        },
        {
          id: "order-8",
          platillo: "Jugo de Naranja",
          ingredientes: "Natural, sin azúcar",
          nota: "Con hielo",
          alumno: "Pedro Ramírez",
          nivel: "Primaria",
          turno: "Desayuno",
          status: "en preparacion",
        },
        {
          id: "order-9",
          platillo: "Burrito de Res",
          ingredientes: "Sin frijoles",
          nota: "",
          alumno: "Valeria Castro",
          nivel: "Preparatoria",
          turno: "Comida",
          status: "pendiente",
        },
        {
          id: "order-10",
          platillo: "Agua de Horchata",
          ingredientes: "Poca azúcar",
          nota: "Vaso grande",
          alumno: "Ricardo Soto",
          nivel: "Secundaria",
          turno: "Comida",
          status: "finalizado",
        },
        {
          id: "order-11",
          platillo: "Hot Dog",
          ingredientes: "Con ketchup y mostaza",
          nota: "Sin pepinillos",
          alumno: "Fernanda Díaz",
          nivel: "Primaria",
          turno: "Comida",
          status: "pendiente",
        },
        {
          id: "order-12",
          platillo: "Licuado de Plátano",
          ingredientes: "Con leche de almendras",
          nota: "",
          alumno: "Jorge Torres",
          nivel: "Preparatoria",
          turno: "Desayuno",
          status: "en preparacion",
        },
        {
          id: "order-13",
          platillo: "Cereal con Leche",
          ingredientes: "Leche entera",
          nota: "Tazón grande",
          alumno: "Gabriela Solís",
          nivel: "Kinder",
          turno: "Desayuno",
          status: "pendiente",
        },
        {
          id: "order-14",
          platillo: "Mini Pizzas",
          ingredientes: "Solo queso",
          nota: "Sin orilla",
          alumno: "Roberto Vega",
          nivel: "Kinder",
          turno: "Comida",
          status: "pendiente",
        },
        {
          id: "order-15",
          platillo: "Yogurt con Granola",
          ingredientes: "Yogurt natural",
          nota: "",
          alumno: "Andrea Luna",
          nivel: "Primaria",
          turno: "Desayuno",
          status: "finalizado",
        },
        {
          id: "order-16",
          platillo: "Sopa de Verduras",
          ingredientes: "Sin sal",
          nota: "Tibia",
          alumno: "Luis Mendoza",
          nivel: "Secundaria",
          turno: "Comida",
          status: "pendiente",
        },
        {
          id: "order-17",
          platillo: "Torta de Jamón",
          ingredientes: "Sin mayonesa",
          nota: "Con aguacate",
          alumno: "Paula Herrera",
          nivel: "Preparatoria",
          turno: "Comida",
          status: "en preparacion",
        },
      ];

      // Definir el orden de prioridad de los niveles educativos
      const nivelOrder = {
        Kinder: 1,
        Primaria: 2,
        Secundaria: 3,
        Preparatoria: 4,
      };

      /**
       * Renderiza las tarjetas de pedidos en sus respectivas columnas.
       */
      function renderOrders() {
        // Limpia las columnas antes de volver a renderizar
        document.getElementById("pendiente-cards").innerHTML = "";
        document.getElementById("en-preparacion-cards").innerHTML = "";
        document.getElementById("finalizado-cards").innerHTML = "";

        // Ordenar los pedidos por nivel educativo antes de renderizar
        const sortedOrders = [...orders].sort((a, b) => {
          return nivelOrder[a.nivel] - nivelOrder[b.nivel];
        });

        sortedOrders.forEach((order) => {
          const card = document.createElement("div");
          card.id = order.id;
          card.className = `bg-white p-4 rounded-lg shadow-sm border border-gray-200 cursor-grab active:cursor-grabbing ${
            order.status === "finalizado" ? "opacity-80" : ""
          }`;
          card.setAttribute("draggable", true); // Hace la tarjeta arrastrable

          // Contenido de la tarjeta
          card.innerHTML = `
                    <h3 class="font-bold text-gray-900 mb-1">${
                      order.platillo
                    }</h3>
                    <p class="text-sm text-gray-600"><strong>Alumno:</strong> ${
                      order.alumno
                    }</p>
                    <p class="text-xs text-gray-500"><strong>Nivel:</strong> ${
                      order.nivel
                    } | <strong>Turno:</strong> ${order.turno}</p>
                    ${
                      order.ingredientes
                        ? `<p class="text-xs text-gray-500"><strong>Ingredientes:</strong> ${order.ingredientes}</p>`
                        : ""
                    }
                    ${
                      order.nota
                        ? `<p class="text-xs text-gray-500"><strong>Nota:</strong> ${order.nota}</p>`
                        : ""
                    }
                `;

          // Añade la tarjeta a la columna correcta, verificando que el elemento exista
          const targetElement = document.getElementById(
            `${order.status}-cards`
          );
          if (targetElement) {
            targetElement.appendChild(card);
          } else {
            console.error(
              `Error: Elemento con ID ${order.status}-cards no encontrado. Asegúrate de que el ID del estado en los datos de prueba coincida con el ID de la columna Kanban.`
            );
          }

          // Añade event listeners para el arrastrar
          card.addEventListener("dragstart", dragStart);
          card.addEventListener("dragend", dragEnd);
        });
      }

      /**
       * Maneja el inicio del arrastre de una tarjeta.
       * @param {DragEvent} event
       */
      function dragStart(event) {
        event.dataTransfer.setData("text/plain", event.target.id); // Guarda el ID de la tarjeta que se arrastra
        event.target.classList.add("dragging"); // Añade clase para feedback visual
      }

      /**
       * Permite soltar elementos en un área.
       * @param {DragEvent} event
       */
      function allowDrop(event) {
        event.preventDefault(); // Necesario para permitir el drop
        // Añade clase para feedback visual al arrastrar sobre la columna
        if (
          event.target.classList.contains("kanban-column") ||
          event.target.closest(".kanban-column")
        ) {
          const column = event.target.classList.contains("kanban-column")
            ? event.target
            : event.target.closest(".kanban-column");
          column.classList.add("drag-over");
        }
      }

      /**
       * Maneja el evento de arrastrar y salir de un área.
       * @param {DragEvent} event
       */
      function dragLeave(event) {
        // Elimina clase de feedback visual al salir de la columna
        if (
          event.target.classList.contains("kanban-column") ||
          event.target.closest(".kanban-column")
        ) {
          const column = event.target.classList.contains("kanban-column")
            ? event.target
            : event.target.closest(".kanban-column");
          column.classList.remove("drag-over");
        }
      }

      /**
       * Maneja el soltar de una tarjeta en una columna.
       * @param {DragEvent} event
       */
      function drop(event) {
        event.preventDefault();
        const cardId = event.dataTransfer.getData("text/plain");
        const draggedCard = document.getElementById(cardId);

        // Determina la columna de destino
        let targetColumn = event.target;
        while (
          targetColumn &&
          !targetColumn.classList.contains("kanban-column")
        ) {
          targetColumn = targetColumn.parentElement;
        }

        if (targetColumn) {
          // Elimina la clase de feedback visual
          targetColumn.classList.remove("drag-over");

          // Obtiene el nuevo status de la columna de destino
          const newStatus = targetColumn.id.replace("-column", "");

          // Actualiza el estado del pedido en los datos
          const orderIndex = orders.findIndex((order) => order.id === cardId);
          if (orderIndex > -1) {
            orders[orderIndex].status = newStatus;
          }

          // Vuelve a renderizar todas las tarjetas para reflejar el cambio
          renderOrders();
        }
      }

      /**
       * Maneja el final del arrastre de una tarjeta.
       * @param {DragEvent} event
       */
      function dragEnd(event) {
        event.target.classList.remove("dragging"); // Elimina la clase de arrastre
        const columns = document.querySelectorAll(".kanban-column");
        columns.forEach((column) => column.classList.remove("drag-over"));
      }

      // Renderiza los pedidos cuando la página carga
      document.addEventListener("DOMContentLoaded", renderOrders);
    </script>
  </body>
</html>
